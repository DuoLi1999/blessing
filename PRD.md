# 新春祝福生成器 — 产品需求文档 (PRD)

## 1. 概述

### 问题

春节期间年轻人需要给大量不同关系的人（长辈、同事、领导、朋友、恋人、客户）发拜年信息，面临三个痛点：
- **措辞困难**：不同关系需要不同的语气和分寸感，给长辈不能太随意、给领导不能太谄媚
- **同质化严重**：网上模板千篇一律，用户直接问 ChatGPT 也容易写出泛泛而谈的内容
- **效率低下**：需要发 10+ 条，每条都要斟酌措辞，社交负担重

### 解决方案

一个纯前端 Web 应用，用户自带 LLM API key，通过**精心设计的 prompt skills 系统**生成个性化马年春节祝福语。核心价值不是"调一次 API"，而是：
1. **UX 便利性**：点两下就出结果，不用思考怎么写 prompt
2. **Prompt 质量壁垒**：每个 skill 包含语气示例、禁忌清单、马年意象词库、few-shot 范例，远超用户自己写的 prompt 质量
3. **批量效率**：一次配置，连续生成 10+ 条不同关系的祝福，ChatGPT 对话框做不到

### 成功指标

- 从打开页面到复制第一条祝福 < 60 秒（含首次配置 API key）
- 生成成功率 > 95%（排除 API key 无效等用户侧问题）
- 单次生成的祝福语被用户复制使用（复制按钮点击率 > 70%）
- 单次会话平均生成 ≥ 3 条（说明用户在批量使用）

---

## 2. 用户体验与功能

### 用户画像

- 20-35 岁职场人/学生，春节期间需要给 10+ 不同关系的人发祝福
- 有基本技术素养，能获取并配置 OpenAI 兼容的 API key
- 主要使用手机浏览器访问

### 用户故事与验收标准

**US-1：配置 API key**
> 作为用户，我希望配置一次 API key 后自动保存，不用每次重新输入。

- 首次访问自动弹出 API 配置弹窗
- 弹窗内提供简要的"如何获取 API key"引导（链接到主流 provider 注册页）
- 支持填写：API key、Base URL（默认 OpenAI）、模型名称
- 配置保存到 localStorage，刷新页面后保留
- Header 提供设置入口，可随时修改配置

**US-2：选择祝福维度**
> 作为用户，我希望通过简单的点选快速定义祝福语的风格。

- 关系选择：6 种（长辈/同事/领导/朋友/恋人/客户），2 列卡片网格，选中红色边框高亮
- 风格选择：5 种（正式/轻松/搞笑/文艺/简短），横向药丸按钮
- 长度选择：3 档（短句 ≤30 字 / 一段 100-200 字 / 长段 300-500 字），分段控件
- 个性化输入：称呼（如"张叔叔"）+ 补充备注（如"他喜欢钓鱼"）

**US-3：生成祝福语**
> 作为用户，我希望点击按钮后快速看到生成的祝福语。

- 点击生成按钮后，结果区域流式逐字显示文本 + 闪烁光标
- 生成过程中按钮显示加载态，可取消请求
- 生成完成后显示完整文本

**US-4：复制与重新生成**
> 作为用户，我希望一键复制祝福语，或者不满意时重新生成。

- 一键复制按钮，点击后显示"已复制"反馈
- 重新生成按钮，保持当前选项不变重新调用
- 生成完成后自动滚动到结果区域

### 非目标（MVP 不做）

- 不做用户账号体系和云端存储
- 不做历史记录管理
- 不做多语言支持（仅中文祝福语）
- 不做自定义 prompt 编辑（prompt 质量是核心壁垒，不开放给用户修改）
- 不做分享到社交平台功能
- 不做后端服务，所有 LLM 调用在浏览器端完成
- 不做免费体验额度（MVP 阶段，用户必须自带 API key；后续版本可考虑加后端支持免费试用 + 邀请机制）

---

## 3. AI 系统需求（核心竞争力）

### 设计原则

本产品与"直接问 ChatGPT"的核心差异在于 **prompt 工程质量**。每个 skill 不是一句话描述，而是包含：
- **具体的语气示例**：不说"写得正式一点"，而是给出正式语气的具体范例
- **禁忌清单**：明确列出每种关系下不能出现的话题和措辞
- **马年意象词库**：提供丰富的马年吉祥话素材（一马当先、马到成功、龙马精神、万马奔腾等）
- **写作手法指令**：比如"搞笑"不是说"写得搞笑"，而是"使用谐音梗、夸张手法、反转结构"
- **Few-shot 范例**：每个关系-风格组合提供 1-2 个高质量示例，引导 LLM 输出质量

### Skills 分层组合架构

采用分层组合式 prompt 组装，而非为每种组合写独立 prompt：

```
Layer 1: 马年主题（始终注入）
         — 马年生肖意象词库、吉祥话素材、文化背景
Layer 2: 基础 Skill（关系维度）
         — 语气基调 + 禁忌清单 + 该关系的 few-shot 范例
Layer 3: 风格修饰器
         — 具体写作手法指令 + 该风格的 few-shot 范例
Layer 4: 长度控制
         — 字数约束 + 结构建议（短句用四字格、长段用总分结构等）
Layer 5: 个性化信息
         — 称呼 + 用户备注，融入祝福内容
→ 输出: { system: string, user: string }
```

6 关系 × 5 风格 = 30 种组合，通过组装自动覆盖。

### 关系 Skills 详细设计

| 关系 | 语气基调 | 禁忌清单 | 范例方向 |
|------|----------|----------|----------|
| 长辈 | 恭敬、温暖、感恩 | 衰老、疾病、死亡、"老"字 | "感谢您一年来的关照，愿您新年…" |
| 同事 | 友好、得体、轻松 | 过于私密的话题、薪资相关 | "合作愉快，新的一年继续并肩…" |
| 领导 | 尊重、专业、真诚 | 谄媚、过于随意、称兄道弟 | "感谢您的指导与信任，新年…" |
| 朋友 | 亲切、随性、有梗 | 无特殊禁忌 | "新的一年继续搞事业/搞钱…" |
| 恋人 | 甜蜜、真挚、浪漫 | 过于正式、商务化 | "新的一年，最想和你一起…" |
| 客户 | 专业、诚恳、祝愿事业 | 过于亲密、家长里短 | "感谢贵司的信任与合作…" |

### 风格修饰器详细设计

| 风格 | 写作手法指令 | 范例方向 |
|------|-------------|----------|
| 正式 | 使用敬语、四字成语、对仗句式；避免口语化和网络用语 | "恭祝新春大吉，万事如意" |
| 轻松 | 口语化表达、适当使用流行语；像朋友聊天一样自然 | "新年快乐呀～新的一年一起加油" |
| 搞笑 | 使用谐音梗、夸张手法、反转结构、自嘲；要有具体笑点 | "马上有钱、马上有对象、马上…算了先马上放假吧" |
| 文艺 | 使用意象、隐喻、诗意表达；可引用古诗词；注重韵律美感 | "愿你如春风过马蹄，轻盈而至…" |
| 简短 | 一句话直击重点；适合群发但不显敷衍；信息密度高 | "马年大吉，万事胜意！" |

### LLM 调用参数

- `temperature: 0.9`（祝福语需要创意多样性）
- `max_tokens: 1024`
- 原生 fetch + ReadableStream 解析 SSE（不用 OpenAI SDK，省约 100KB）
- 支持 AbortController 取消

### 质量评估标准

- 生成内容包含马年相关元素（不是生硬插入，而是自然融合）
- 语气和措辞符合所选关系的基调，不触碰禁忌清单
- 风格与所选修饰器匹配（搞笑的确实有笑点，文艺的确实有意境）
- 字数在目标范围内（±20% 容差）
- 不与 few-shot 范例高度雷同（避免背诵模板）

---

## 4. 技术规格

### 技术栈

- React + Vite + SWC + TypeScript
- Tailwind CSS v4（CSS-based 配置）
- pnpm 包管理
- 无后端、无路由库、无状态管理库

### 架构

```
用户浏览器
├── React SPA（Vite 构建）
│   ├── UI 组件层（表单、结果展示）
│   ├── Hooks 层（useApiKey, useGenerate）
│   ├── Skills 引擎（prompt 组装）
│   └── LLM 服务（fetch + SSE 流式解析）
│
└── localStorage（API 配置持久化）
        ↕
    OpenAI 兼容 API（用户自带 key）
```

### UI 设计规范

- 移动端优先，`max-w-lg` 居中
- 春节主题色：festival-red `#c41e2a` + festival-gold `#d4a528`，暖白底 `#fefcf8`
- 不做满屏红色，红色和金色仅作点缀

### 安全与隐私

- API key 仅存储在用户浏览器 localStorage 中
- API 请求直接从浏览器发出，不经过任何中间服务器
- 不收集任何用户数据

---

## 5. 风险与路线图

### MVP（当前）

- 完整的 6×5 关系风格组合生成
- 流式输出 + 复制
- 移动端适配

### v1.1（可选迭代）

- 免费体验额度 + 邀请裂变机制（需加后端：Cloudflare Workers / Vercel Edge Function）
- 历史记录管理
- 更多关系类型（如：老师、亲戚细分）
- 批量生成模式

### 技术风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 用户 API key 无效或余额不足 | 生成失败 | 清晰的错误提示，引导用户检查配置 |
| 部分 LLM provider 不完全兼容 OpenAI 格式 | 流式解析失败 | 做好 SSE 解析的容错处理 |
| 浏览器 CORS 限制 | 无法直接调用某些 API | 提示用户使用支持 CORS 的 provider |
